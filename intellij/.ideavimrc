" IntelliJ IdeaVim profile generated from Neovim mappings in this repo.
" Source from ~/.ideavimrc with:
"   source ~/.config/nvim/intellij/.ideavimrc
"
" Notes:
" - <leader> and <localleader> are both space to mirror Neovim.
" - Mappings prioritize workflow parity (search, buffers, explorer, git, LSP, debug).
" - Where IntelliJ has no exact primitive, nearest action is used.

let mapleader = " "
let maplocalleader = " "

" ---------- Stateful toggles ----------
" IdeaVim/IntelliJ actions don't expose tool-window visibility to Vimscript.
" We emulate Neovim-like toggles by tracking state for keys that are toggles in your nvim config.
let g:ba_tw_project_open = get(g:, 'ba_tw_project_open', 0)
let g:ba_tw_terminal_open = get(g:, 'ba_tw_terminal_open', 0)
let g:ba_tw_vcs_open = get(g:, 'ba_tw_vcs_open', 0)
let g:ba_tw_todo_open = get(g:, 'ba_tw_todo_open', 0)
let g:ba_tw_debug_open = get(g:, 'ba_tw_debug_open', 0)
let g:ba_tw_problems_open = get(g:, 'ba_tw_problems_open', 0)

function! BaToggleToolwindow(varname, activate_action) abort
  if get(g:, a:varname, 0)
    execute 'action ' . a:activate_action
    action HideActiveWindow
    execute 'let g:' . a:varname . ' = 0'
  else
    execute 'action ' . a:activate_action
    execute 'let g:' . a:varname . ' = 1'
  endif
endfunction

function! BaToggleProjectWindow() abort
  if g:ba_tw_project_open
    action ActivateProjectToolWindow
    action HideActiveWindow
    let g:ba_tw_project_open = 0
  else
    action ActivateProjectToolWindow
    let g:ba_tw_project_open = 1
  endif
  action FocusEditor
endfunction

function! BaToggleTerminalWindow() abort
  if g:ba_tw_terminal_open
    action ActivateTerminalToolWindow
    action HideActiveWindow
    let g:ba_tw_terminal_open = 0
  else
    action ActivateTerminalToolWindow
    let g:ba_tw_terminal_open = 1
  endif
  action FocusEditor
endfunction

" ---------- Core ----------
nmap <silent> <C-s> <Action>(SaveAll)
nnoremap <silent> <leader>qa :action SaveAll<CR>:action Exit<CR>
nmap <silent> <leader>qf <Action>(ActivateProblemsViewToolWindow)
nmap <silent> dq <Action>(CloseContent)

" ---------- Move line / selection ----------
nmap <silent> <A-Up> <Action>(MoveLineUp)
nmap <silent> <A-Down> <Action>(MoveLineDown)
nmap <silent> <A-k> <Action>(MoveLineUp)
nmap <silent> <A-j> <Action>(MoveLineDown)

xmap <silent> <A-Up> <Action>(MoveLineUp)
xmap <silent> <A-Down> <Action>(MoveLineDown)
xmap <silent> <A-k> <Action>(MoveLineUp)
xmap <silent> <A-j> <Action>(MoveLineDown)

imap <silent> <A-Up> <Action>(MoveLineUp)
imap <silent> <A-Down> <Action>(MoveLineDown)
imap <silent> <A-k> <Action>(MoveLineUp)
imap <silent> <A-j> <Action>(MoveLineDown)

" ---------- Windows / tabs ----------
nmap <silent> <C-h> <Action>(PreviousProjectWindow)
nmap <silent> <C-j> <Action>(PreviousProjectWindow)
nmap <silent> <C-k> <Action>(NextProjectWindow)
nmap <silent> <C-l> <Action>(NextProjectWindow)

nmap <silent> <leader>bp <Action>(PinActiveTab)
nmap <silent> <leader>bP <Action>(CloseAllEditorsButPinned)
nmap <silent> <leader>br <Action>(CloseAllToTheRight)
nmap <silent> <leader>bl <Action>(CloseAllToTheLeft)
nmap <silent> <S-h> <Action>(PreviousTab)
nmap <silent> <S-l> <Action>(NextTab)
nmap <silent> [b <Action>(PreviousTab)
nmap <silent> ]b <Action>(NextTab)
nmap <silent> [B <Action>(MoveTabLeft)
nmap <silent> ]B <Action>(MoveTabRight)

" ---------- Explorer / terminal ----------
nmap <silent> <leader>e :call BaToggleProjectWindow()<CR>
nmap <silent> <Bslash> :call BaToggleProjectWindow()<CR>
nmap <silent> <leader>tt :call BaToggleTerminalWindow()<CR>
nmap <silent> <leader>os :call BaToggleToolwindow('ba_tw_vcs_open', 'ActivateVersionControlToolWindow')<CR>
nmap <silent> <leader>ob <Action>(RecentFiles)

" ---------- Smart finding / search ----------
" Requested parity:
" - <leader>/  => project grep alternative
" - <leader><leader> => full project file finder
nmap <silent> <leader><space> <Action>(SearchEverywhere)
nmap <silent> <leader><leader> <Action>(GotoFile)
nmap <silent> <leader>, <Action>(RecentFiles)
nmap <silent> <leader>/ <Action>(FindInPath)
nmap <silent> <leader>: <Action>(GotoAction)
nmap <silent> <leader>n <Action>(Notifications)

nmap <silent> <leader>fb <Action>(RecentFiles)
nmap <silent> <leader>fc <Action>(GotoFile)
nmap <silent> <leader>ff <Action>(GotoFile)
nmap <silent> <leader>fg <Action>(RecentChangedFiles)
nmap <silent> <leader>fp <Action>(ManageRecentProjects)
nmap <silent> <leader>fr <Action>(RecentFiles)

nmap <silent> <leader>sb <Action>(Find)
nmap <silent> <leader>sB <Action>(FindInPath)
nmap <silent> <leader>sw viw<Action>(FindInPath)
xmap <silent> <leader>sw <Action>(FindInPath)
nmap <silent> <leader>s/ <Action>(Find)
nmap <silent> <leader>sA <Action>(GotoAction)
nmap <silent> <leader>sc <Action>(GotoAction)
nmap <silent> <leader>sC <Action>(GotoAction)
nmap <silent> <leader>sd :call BaToggleToolwindow('ba_tw_problems_open', 'ActivateProblemsViewToolWindow')<CR>
nmap <silent> <leader>sD <Action>(ShowErrorDescription)
nmap <silent> <leader>sh <Action>(HelpTopics)
nmap <silent> <leader>sj <Action>(RecentLocations)
nmap <silent> <leader>sk <Action>(Keymap)
nmap <silent> <leader>sl <Action>(ActivateProblemsViewToolWindow)
nmap <silent> <leader>sm <Action>(ShowBookmarks)
nmap <silent> <leader>sp <Action>(SearchEverywhere)
nmap <silent> <leader>sP <Action>(GotoAction)
nmap <silent> <leader>sq <Action>(ActivateProblemsViewToolWindow)
nmap <silent> <leader>s. <Action>(RecentFiles)
nmap <silent> <leader>su <Action>(LocalHistory.ShowHistory)
nmap <silent> <leader>ss <Action>(FileStructurePopup)
nmap <silent> <leader>sS <Action>(GotoSymbol)
nmap <silent> <leader>st :call BaToggleToolwindow('ba_tw_todo_open', 'ActivateTODOToolWindow')<CR>
nmap <silent> <leader>sT :call BaToggleToolwindow('ba_tw_todo_open', 'ActivateTODOToolWindow')<CR>

" ---------- LSP / diagnostics / refactor ----------
nmap <silent> ga <Action>(ShowIntentionActions)
xmap <silent> ga <Action>(ShowIntentionActions)
nmap <silent> gd <Action>(GotoDeclaration)
nmap <silent> gD <Action>(GotoTypeDeclaration)
nmap <silent> gr <Action>(ShowUsages)
nmap <silent> gI <Action>(GotoImplementation)
nmap <silent> gy <Action>(GotoTypeDeclaration)

nmap <silent> <leader>rn <Action>(RenameElement)
nmap <silent> <leader>bF <Action>(ReformatCode)
nmap <silent> <leader>rw <Action>(Replace)
nmap <silent> <leader>r <Action>(Replace)
nmap <silent> <leader>sr <Action>(ReplaceInPath)
xmap <silent> <leader>sr <Action>(ReplaceInPath)

nmap <silent> ]d <Action>(GotoNextError)
nmap <silent> [d <Action>(GotoPreviousError)
nmap <silent> ]h <Action>(GotoNextError)
nmap <silent> [h <Action>(GotoPreviousError)
nmap <silent> <leader>k <Action>(ShowErrorDescription)
nmap <silent> <C-w>d <Action>(ShowErrorDescription)
nmap <silent> <leader>th <Action>(ToggleInlayHintsGloballyAction)

nmap <silent> [t <Action>(FindPrevious)
nmap <silent> ]t <Action>(FindNext)
nmap <silent> <leader>cs <Action>(FileStructurePopup)
nmap <silent> <leader>cl <Action>(ShowUsages)
nmap <silent> <leader>xx :call BaToggleToolwindow('ba_tw_problems_open', 'ActivateProblemsViewToolWindow')<CR>
nmap <silent> <leader>xX :call BaToggleToolwindow('ba_tw_problems_open', 'ActivateProblemsViewToolWindow')<CR>
nmap <silent> <leader>xL :call BaToggleToolwindow('ba_tw_problems_open', 'ActivateProblemsViewToolWindow')<CR>
nmap <silent> <leader>xQ :call BaToggleToolwindow('ba_tw_problems_open', 'ActivateProblemsViewToolWindow')<CR>
nmap <silent> <leader>xt :call BaToggleToolwindow('ba_tw_todo_open', 'ActivateTODOToolWindow')<CR>
nmap <silent> <leader>xT :call BaToggleToolwindow('ba_tw_todo_open', 'ActivateTODOToolWindow')<CR>
nmap <silent> <leader>uc <Action>(QuickChangeColorScheme)

" ---------- Git ----------
nmap <silent> <leader>gg <Action>(Vcs.QuickListPopupAction)
nmap <silent> <leader>gp <Action>(OpenInBrowser)
nmap <silent> <leader>gb <Action>(Git.Branches)
nmap <silent> <leader>gl <Action>(Vcs.ShowTabbedFileHistory)
nmap <silent> <leader>gL <Action>(Annotate)
nmap <silent> <leader>gs :call BaToggleToolwindow('ba_tw_vcs_open', 'ActivateVersionControlToolWindow')<CR>
nmap <silent> <leader>gS <Action>(Git.Unstash)
nmap <silent> <leader>gD <Action>(ShowDiff)
nmap <silent> <leader>gf <Action>(Vcs.ShowTabbedFileHistory)
nmap <silent> <leader>gc <Action>(CheckinProject)
nmap <silent> <leader>gac <Action>(CheckinProject)
nmap <silent> <leader>gd <Action>(ShowDiff)

nmap <silent> [c <Action>(VcsShowPrevChangeMarker)
nmap <silent> ]c <Action>(VcsShowNextChangeMarker)

nmap <silent> <leader>bb <Action>(Annotate)
nmap <silent> <leader>tb <Action>(Annotate)
nmap <silent> <leader>tw <Action>(ShowDiff)

nmap <silent> <leader>hs <Action>(CheckinProject)
xmap <silent> <leader>hs <Action>(CheckinProject)
nmap <silent> <leader>hr <Action>(Rollback)
xmap <silent> <leader>hr <Action>(Rollback)
nmap <silent> <leader>hS <Action>(CheckinProject)
nnoremap <silent> <leader>hu u
nmap <silent> <leader>hR <Action>(Rollback)
nmap <silent> <leader>hh <Action>(ShowDiff)
nmap <silent> <leader>hi <Action>(ShowDiff)
nmap <silent> <leader>hb <Action>(Annotate)
nmap <silent> <leader>hB <Action>(Vcs.ShowTabbedFileHistory)
nmap <silent> <leader>hd <Action>(ShowDiff)

" ---------- Debug ----------
nmap <silent> <leader>dc <Action>(Debug)
nmap <silent> <leader>dj <Action>(StepInto)
nmap <silent> <leader>dl <Action>(StepOver)
nmap <silent> <leader>dk <Action>(StepOut)
nmap <silent> <leader>db <Action>(ToggleLineBreakpoint)
nmap <silent> <leader>dB <Action>(ViewBreakpoints)
nmap <silent> <leader>dr :call BaToggleToolwindow('ba_tw_debug_open', 'ActivateDebugToolWindow')<CR>

" Rust / DAML approximations
nmap <silent> <leader>cR <Action>(ShowIntentionActions)
nmap <silent> <leader>gt <Action>(Run)

" ---------- Session / history / misc ----------
nmap <silent> <leader>uu <Action>(LocalHistory.ShowHistory)
nmap <silent> <leader>qs <Action>(ManageRecentProjects)
nmap <silent> <leader>qS <Action>(ManageRecentProjects)
nmap <silent> <leader>ql <Action>(ManageRecentProjects)
nmap <silent> <leader>qd <Action>(ManageRecentProjects)
nmap <silent> <leader>lz <Action>(ShowSettings)

" ---------- Noice-style message history approximations ----------
nmap <silent> <leader>snl <Action>(Notifications)
nmap <silent> <leader>snh <Action>(Notifications)
nmap <silent> <leader>sna <Action>(Notifications)
nmap <silent> <leader>snd <Action>(Notifications)
nmap <silent> <leader>snt <Action>(Notifications)

" ---------- Not ported intentionally ----------
" <leader>s (operator-grep by motion) has no equivalent operator model in IntelliJ.
" <leader>um (render-markdown toggle) is Neovim-plugin-specific.
" <leader>cp (markdown-preview toggle) depends on an IntelliJ Markdown preview action id that differs by product/plugin.
" flash.nvim keys (s/S/r/R) intentionally left to IdeaVim defaults to avoid breaking core motions.
